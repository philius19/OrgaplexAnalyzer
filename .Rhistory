df <- read.csv(file_path,
sep = ",",
skip = 4,
header = FALSE)
# Store in list
data_list[[df_name]] <- df
print(paste("Loaded:", df_name))
}
View(data_list)
library(plyr)
base_path <- "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_and_without_LD/Control"
list.files(base_path)
# Output: character vector
# Example: ["file1.txt", "file2.csv", "script.R"]
subdir_path <- file.path(base_path, "control_1_ER_Statistics")
files <- list.files(subdir_path,
pattern = "Shortest_Distance_to_Surfaces_Surfaces",
full.names = TRUE)
print(files)
df <- read.csv(files[1],        # Corresponds to the first path in our file list
sep = ",",       # The data is seperated by ","
skip = 4,        # We skip the first 4 rows
header = FALSE   # We dont need a header
)
print(df)
# Create empty list to store dataframes
data_list <- list()
# Loop through all files
for (file_path in files) {
# Get just the filename for naming
filename <- basename(file_path)
# Remove .csv extension for cleaner name
df_name <- gsub("\\.csv$", "", filename)
# Read CSV
df <- read.csv(file_path,
sep = ",",
skip = 4,
header = FALSE)
# Store in list
data_list[[df_name]] <- df
print(paste("Loaded:", df_name))
}
data_list[["control_1_ER_Shortest_Distance_to_Surfaces_Surfaces=LD"]]
library(plyr)
library(openxlsx)
library(plyr)
library(openxlsx)
install.packages("openxlsx")
library(plyr)
library(openxlsx)
# Your existing data_list with all dataframes loaded
# names(data_list) looks like: "control_1_ER_Shortest_Distance_to_Surfaces_Surfaces=LD"
# Create empty dataframe to store results
results <- data.frame(
Sample = character(),
Interaction = character(),
Source = character(),
Target = character(),
Mean = numeric(),
Count = integer(),
stringsAsFactors = FALSE
)
# Loop through all dataframes
for (df_name in names(data_list)) {
# Get the dataframe
df <- data_list[[df_name]]
# Extract sample name (e.g., "control_1")
sample <- gsub("^([^_]+_[^_]+)_.*", "\\1", df_name).
# Define all organelles
organelles <- c("ER", "M", "P", "Ly", "LD")
# Your existing data_list
# Example name: "control_1_ER_Shortest_Distance_to_Surfaces_Surfaces=LD"
# Create results storage
results <- data.frame(
Sample = character(),
Interaction = character(),
Source = character(),
Target = character(),
Mean = numeric(),
Count = integer(),
stringsAsFactors = FALSE
)
# Loop through all dataframes
for (df_name in names(data_list)) {
# Get the dataframe
df <- data_list[[df_name]]
# ===== Extract Sample Name (by splitting) =====
# Split by underscore
parts <- strsplit(df_name, "_")[[1]]
# Combine first two parts: "control" + "1" = "control_1"
sample <- paste(parts[1], parts[2], sep = "_")
# ===== Find Source Organelle =====
source <- NA
for (org in organelles) {
# Check if organelle appears before "_Shortest"
pattern <- paste0("_", org, "_Shortest")
if (grepl(pattern, df_name)) {
source <- org
break  # Stop once we find it
}
}
# ===== Find Target Organelle =====
target <- NA
for (org in organelles) {
# Check if organelle appears after "Surfaces="
pattern <- paste0("Surfaces=", org)
if (grepl(pattern, df_name)) {
target <- org
break
}
}
# Create interaction name
interaction <- paste0(source, "_to_", target)
# Calculate metrics
mean_value <- mean(df[, 1], na.rm = TRUE)
count_value <- sum(!is.na(df[, 1]))
# Add to results
results <- rbind(results, data.frame(
Sample = sample,
Interaction = interaction,
Source = source,
Target = target,
Mean = mean_value,
Count = count_value,
stringsAsFactors = FALSE
))
print(paste("✓", sample, "-", interaction, "| Mean:", round(mean_value, 3), "| Count:", count_value))
}
# View results
print(results)
# Export
output_path <- file.path(base_path, "Organelle_Interactions_Summary.xlsx")
write.xlsx(results, output_path, rowNames = FALSE)
# Define all organelles
organelles <- c("ER", "M", "P", "Ly", "LD")
# Your existing data_list
# Example name: "control_1_ER_Shortest_Distance_to_Surfaces_Surfaces=LD"
# Create results storage
results <- data.frame(
Sample = character(),
Interaction = character(),
Source = character(),
Target = character(),
Mean = numeric(),
Count = integer(),
stringsAsFactors = FALSE
)
# Loop through all dataframes
for (df_name in names(data_list)) {
# Get the dataframe
df <- data_list[[df_name]]
# ===== Extract Sample Name (by splitting) =====
# Split by underscore
parts <- strsplit(df_name, "_")[[1]]
# Combine first two parts: "control" + "1" = "control_1"
sample <- paste(parts[1], parts[2], sep = "_")
# ===== Find Source Organelle =====
source <- NA
for (org in organelles) {
# Check if organelle appears before "_Shortest"
pattern <- paste0("_", org, "_Shortest")
if (grepl(pattern, df_name)) {
source <- org
break  # Stop once we find it
}
}
# ===== Find Target Organelle =====
target <- NA
for (org in organelles) {
# Check if organelle appears after "Surfaces="
pattern <- paste0("Surfaces=", org)
if (grepl(pattern, df_name)) {
target <- org
break
}
}
# Create interaction name
interaction <- paste0(source, "_to_", target)
# Calculate metrics
mean_value <- mean(df[, 1], na.rm = TRUE)
count_value <- sum(!is.na(df[, 1]))
# Add to results
results <- rbind(results, data.frame(
Sample = sample,
Interaction = interaction,
Source = source,
Target = target,
Mean = mean_value,
Count = count_value,
stringsAsFactors = FALSE
))
print(paste("✓", sample, "-", interaction, "| Mean:", round(mean_value, 3), "| Count:", count_value))
}
# View results
print(results)
# Export
output_path <- file.path(base_path, "Organelle_Interactions_Summary.xlsx")
write.xlsx(results, output_path, rowNames = FALSE)
# ============================================================================
# AUTOMATED ORGANELLE INTERACTION ANALYSIS
# ============================================================================
#
# PURPOSE:
# This script processes Imaris-generated organelle segmentation data to analyze
# interactions between different organelles within cells. It automatically:
# - Detects whether the dataset contains Lipid Droplets (LD)
# - Groups data by individual cells
# - Calculates mean distances and counts for all organelle interactions
# - Exports results as Excel files (one per cell)
#
# AUTHOR: Philipp Kaintoch
# DATE: 2025-10-09
# Version: beta 0.5
# ============================================================================
# Load required library for Excel export
library(openxlsx)
# ============================================================================
# STEP 0: USER INPUT - SET YOUR PARENT DIRECTORY HERE
# ============================================================================
#
# IMPORTANT: This is the ONLY line you need to change!
#
# Examples:
# - For datasets WITH LD (direct structure):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_but_with_LD"
#
# - For datasets WITHOUT LD (nested structure with Control folder):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_and_without_LD"
#
parent_dir <- "/path/to/your/parent/directory"
# ============================================================================
# STEP 1: DETECT FOLDER STRUCTURE (LD vs. Non-LD Dataset)
# ============================================================================
#
# The script automatically detects two possible data structures:
#
# STRUCTURE 1 (with LD): Folders are DIRECTLY in parent_dir
#   parent_dir/
#     ├── control_1_ER_Statistics/
#     ├── control_1_LD_Statistics/
#     ├── control_1_Ly_Statistics/
#     └── ...
#
# STRUCTURE 2 (without LD): Folders are in SUBDIRECTORIES
#   parent_dir/
#     ├── Control/
#     │   ├── control_1_ER_Statistics/
#     │   ├── control_1_Ly_Statistics/
#     │   └── ...
#     └── ...
#
cat("\n")
cat("================================================================================\n")
cat("          ORGANELLE INTERACTION ANALYSIS - STARTING ANALYSIS\n")
cat("================================================================================\n\n")
cat("STEP 1: Analyzing folder structure...\n")
cat("------------------------------------------------------------------------\n")
# Get all items in the parent directory
all_items <- list.files(parent_dir, full.names = TRUE)
# Filter to keep only directories (not files)
all_dirs <- all_items[file.info(all_items)$isdir]
# Check if any directory name ends with "_Statistics"
# This pattern indicates that cell folders are directly in parent_dir
has_statistics_dirs <- any(grepl("_Statistics$", basename(all_dirs)))
# Determine the structure based on the presence of "_Statistics" folders
if (has_statistics_dirs) {
# STRUCTURE 1: Direct structure (WITH LD)
cat("✓ Structure detected: Cell folders are DIRECTLY in parent directory\n")
cat("✓ LD Status: Dataset CONTAINS Lipid Droplets (LD)\n")
search_dir <- parent_dir
has_LD <- TRUE
} else {
# STRUCTURE 2: Nested structure (WITHOUT LD)
cat("✓ Structure detected: Cell folders are in SUBDIRECTORIES\n")
cat("✓ LD Status: Dataset does NOT contain Lipid Droplets (LD)\n")
# Search for subdirectories that contain "_Statistics" folders
search_dirs <- c()
for (subdir in all_dirs) {
subdir_contents <- list.files(subdir, full.names = TRUE)
subdir_dirs <- subdir_contents[file.info(subdir_contents)$isdir]
# Check if this subdirectory contains "_Statistics" folders
if (any(grepl("_Statistics$", basename(subdir_dirs)))) {
search_dirs <- c(search_dirs, subdir)
}
}
# Error handling: No valid subdirectories found
if (length(search_dirs) == 0) {
stop("ERROR: No valid cell folders found! Please check your parent_dir path.")
}
cat("✓ Found", length(search_dirs), "subdirectories with cell data\n")
# Display all found subdirectories
for (dir in search_dirs) {
cat("  - ", basename(dir), "\n", sep = "")
}
# Use the first subdirectory (typically "Control")
search_dir <- search_dirs[1]
has_LD <- FALSE
cat("✓ Using subdirectory:", basename(search_dir), "\n")
}
# ============================================================================
# AUTOMATED ORGANELLE INTERACTION ANALYSIS
# ============================================================================
#
# PURPOSE:
# This script processes Imaris-generated organelle segmentation data to analyze
# interactions between different organelles within cells. It automatically:
# - Detects whether the dataset contains Lipid Droplets (LD)
# - Groups data by individual cells
# - Calculates mean distances and counts for all organelle interactions
# - Exports results as Excel files (one per cell)
#
# AUTHOR: Philipp Kaintoch
# DATE: 2025-10-09
# Version: beta 0.5
# ============================================================================
# Load required library for Excel export
library(openxlsx)
# ============================================================================
# STEP 0: USER INPUT - SET YOUR PARENT DIRECTORY HERE
# ============================================================================
#
# IMPORTANT: This is the ONLY line you need to change!
#
# Examples:
# - For datasets WITH LD (direct structure):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_but_with_LD"
#
# - For datasets WITHOUT LD (nested structure with Control folder):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_and_without_LD"
#
parent_dir <- "/path/to/your/parent/directory"
# ============================================================================
# STEP 1: DETECT FOLDER STRUCTURE (LD vs. Non-LD Dataset)
# ============================================================================
#
# The script automatically detects two possible data structures:
#
# STRUCTURE 1 (with LD): Folders are DIRECTLY in parent_dir
#   parent_dir/
#     ├── control_1_ER_Statistics/
#     ├── control_1_LD_Statistics/
#     ├── control_1_Ly_Statistics/
#     └── ...
#
# STRUCTURE 2 (without LD): Folders are in SUBDIRECTORIES
#   parent_dir/
#     ├── Control/
#     │   ├── control_1_ER_Statistics/
#     │   ├── control_1_Ly_Statistics/
#     │   └── ...
#     └── ...
#
cat("\n")
cat("================================================================================\n")
cat("          ORGANELLE INTERACTION ANALYSIS - STARTING ANALYSIS\n")
cat("================================================================================\n\n")
cat("STEP 1: Analyzing folder structure...\n")
cat("------------------------------------------------------------------------\n")
# Get all items in the parent directory
all_items <- list.files(parent_dir, full.names = TRUE)
# Filter to keep only directories (not files)
all_dirs <- all_items[file.info(all_items)$isdir]
# Check if any directory name ends with "_Statistics"
# This pattern indicates that cell folders are directly in parent_dir
has_statistics_dirs <- any(grepl("_Statistics$", basename(all_dirs)))
# Determine the structure based on the presence of "_Statistics" folders
if (has_statistics_dirs) {
# STRUCTURE 1: Direct structure (WITH LD)
cat("✓ Structure detected: Cell folders are DIRECTLY in parent directory\n")
cat("✓ LD Status: Dataset CONTAINS Lipid Droplets (LD)\n")
search_dir <- parent_dir
has_LD <- TRUE
} else {
# STRUCTURE 2: Nested structure (WITHOUT LD)
cat("✓ Structure detected: Cell folders are in SUBDIRECTORIES\n")
cat("✓ LD Status: Dataset does NOT contain Lipid Droplets (LD)\n")
# Search for subdirectories that contain "_Statistics" folders
search_dirs <- c()
for (subdir in all_dirs) {
subdir_contents <- list.files(subdir, full.names = TRUE)
subdir_dirs <- subdir_contents[file.info(subdir_contents)$isdir]
# Check if this subdirectory contains "_Statistics" folders
if (any(grepl("_Statistics$", basename(subdir_dirs)))) {
search_dirs <- c(search_dirs, subdir)
}
}
# Error handling: No valid subdirectories found
if (length(search_dirs) == 0) {
stop("ERROR: No valid cell folders found! Please check your parent_dir path.")
}
cat("✓ Found", length(search_dirs), "subdirectories with cell data\n")
# Display all found subdirectories
for (dir in search_dirs) {
cat("  - ", basename(dir), "\n", sep = "")
}
# Use the first subdirectory (typically "Control")
search_dir <- search_dirs[1]
has_LD <- FALSE
cat("✓ Using subdirectory:", basename(search_dir), "\n")
}
# ============================================================================
# AUTOMATED ORGANELLE INTERACTION ANALYSIS
# ============================================================================
#
# PURPOSE:
# This script processes Imaris-generated organelle segmentation data to analyze
# interactions between different organelles within cells. It automatically:
# - Detects whether the dataset contains Lipid Droplets (LD)
# - Groups data by individual cells
# - Calculates mean distances and counts for all organelle interactions
# - Exports results as Excel files (one per cell)
#
# AUTHOR: Philipp Kaintoch
# DATE: 2025-10-09
# Version: beta 0.5
# ============================================================================
# Load required library for Excel export
library(openxlsx)
# ============================================================================
# STEP 0: USER INPUT - SET YOUR PARENT DIRECTORY HERE
# ============================================================================
#
# IMPORTANT: This is the ONLY line you need to change!
#
# Examples:
# - For datasets WITH LD (direct structure):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_but_with_LD"
#
# - For datasets WITHOUT LD (nested structure with Control folder):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_and_without_LD"
#
parent_dir <- "/path/to/your/parent/directory"
# ============================================================================
# STEP 1: DETECT FOLDER STRUCTURE (LD vs. Non-LD Dataset)
# ============================================================================
#
# The script automatically detects two possible data structures:
#
# STRUCTURE 1 (with LD): Folders are DIRECTLY in parent_dir
#   parent_dir/
#     ├── control_1_ER_Statistics/
#     ├── control_1_LD_Statistics/
#     ├── control_1_Ly_Statistics/
#     └── ...
#
# STRUCTURE 2 (without LD): Folders are in SUBDIRECTORIES
#   parent_dir/
#     ├── Control/
#     │   ├── control_1_ER_Statistics/
#     │   ├── control_1_Ly_Statistics/
#     │   └── ...
#     └── ...
#
cat("\n")
cat("================================================================================\n")
cat("          ORGANELLE INTERACTION ANALYSIS - STARTING ANALYSIS\n")
cat("================================================================================\n\n")
cat("STEP 1: Analyzing folder structure...\n")
cat("------------------------------------------------------------------------\n")
# Get all items in the parent directory
all_items <- list.files(parent_dir, full.names = TRUE)
# Filter to keep only directories (not files)
all_dirs <- all_items[file.info(all_items)$isdir]
# Check if any directory name ends with "_Statistics"
# This pattern indicates that cell folders are directly in parent_dir
has_statistics_dirs <- any(grepl("_Statistics$", basename(all_dirs)))
# Determine the structure based on the presence of "_Statistics" folders
if (has_statistics_dirs) {
# STRUCTURE 1: Direct structure (WITH LD)
cat("✓ Structure detected: Cell folders are DIRECTLY in parent directory\n")
cat("✓ LD Status: Dataset CONTAINS Lipid Droplets (LD)\n")
search_dir <- parent_dir
has_LD <- TRUE
} else {
# STRUCTURE 2: Nested structure (WITHOUT LD)
cat("✓ Structure detected: Cell folders are in SUBDIRECTORIES\n")
cat("✓ LD Status: Dataset does NOT contain Lipid Droplets (LD)\n")
# Search for subdirectories that contain "_Statistics" folders
search_dirs <- c()
for (subdir in all_dirs) {
subdir_contents <- list.files(subdir, full.names = TRUE)
subdir_dirs <- subdir_contents[file.info(subdir_contents)$isdir]
# Check if this subdirectory contains "_Statistics" folders
if (any(grepl("_Statistics$", basename(subdir_dirs)))) {
search_dirs <- c(search_dirs, subdir)
}
}
# Error handling: No valid subdirectories found
if (length(search_dirs) == 0) {
stop("ERROR: No valid cell folders found! Please check your parent_dir path.")
}
cat("✓ Found", length(search_dirs), "subdirectories with cell data\n")
# Display all found subdirectories
for (dir in search_dirs) {
cat("  - ", basename(dir), "\n", sep = "")
}
# Use the first subdirectory (typically "Control")
search_dir <- search_dirs[1]
has_LD <- FALSE
cat("✓ Using subdirectory:", basename(search_dir), "\n")
}
#
# IMPORTANT: This is the ONLY line you need to change!
#
# Examples:
# - For datasets WITH LD (direct structure):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_but_with_LD"
#
# - For datasets WITHOUT LD (nested structure with Control folder):
#   "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_and_without_LD"
#
parent_dir <- "/Users/philippkaintoch/Documents/Projects/07_R-Scripts_Chahat/Raw_data_for_Orgaplex_Test/Cells_without_N_but_with_LD"
